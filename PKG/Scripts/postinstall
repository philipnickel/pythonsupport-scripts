#!/bin/sh
echo "=== POSTINSTALL SCRIPT ==="
echo "Postinstall script executed at $(date)" > /tmp/dtu_postinstall.log
echo "Current user: $(whoami)" >> /tmp/dtu_postinstall.log
echo "Current directory: $(pwd)" >> /tmp/dtu_postinstall.log
echo "Environment variables:" >> /tmp/dtu_postinstall.log
env >> /tmp/dtu_postinstall.log

# Set environment variables for the orchestrator
export PIS_INSTALL_METHOD="PKG"
export PYTHON_VERSION_PS="3.11"
export GITHUB_CI="true"

echo "Executing orchestrator..." >> /tmp/dtu_postinstall.log

# Execute the bundled orchestrator script
orchestrator_script="/usr/local/bin/dtu_orchestrator.sh"

if [ -f "$orchestrator_script" ]; then
    echo "Orchestrator found, executing..." >> /tmp/dtu_postinstall.log
    /bin/bash "$orchestrator_script" >> /tmp/dtu_postinstall.log 2>&1
    echo "Orchestrator execution completed" >> /tmp/dtu_postinstall.log
else
    echo "ERROR: Orchestrator not found at $orchestrator_script" >> /tmp/dtu_postinstall.log
    exit 1
fi

echo "Postinstall completed successfully"
exit 0